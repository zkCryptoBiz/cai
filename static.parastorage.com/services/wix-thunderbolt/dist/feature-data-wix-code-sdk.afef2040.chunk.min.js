(self.webpackJsonp__wix_thunderbolt_app=self.webpackJsonp__wix_thunderbolt_app||[]).push([[4600],{69012:function(e){var t=Object.prototype.toString;e.exports=function(e){var r=typeof e;return"undefined"===r?"undefined":null===e?"null":!0===e||!1===e||e instanceof Boolean?"boolean":"string"===r||e instanceof String?"string":"number"===r||e instanceof Number?"number":"function"===r||e instanceof Function?void 0!==e.constructor.name&&"Generator"===e.constructor.name.slice(0,9)?"generatorfunction":"function":void 0!==Array.isArray&&Array.isArray(e)?"array":e instanceof RegExp?"regexp":e instanceof Date?"date":"[object RegExp]"===(r=t.call(e))?"regexp":"[object Date]"===r?"date":"[object Arguments]"===r?"arguments":"[object Error]"===r?"error":"[object Promise]"===r?"promise":function(e){return e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}(e)?"buffer":"[object Set]"===r?"set":"[object WeakSet]"===r?"weakset":"[object Map]"===r?"map":"[object WeakMap]"===r?"weakmap":"[object Symbol]"===r?"symbol":"[object Map Iterator]"===r?"mapiterator":"[object Set Iterator]"===r?"setiterator":"[object String Iterator]"===r?"stringiterator":"[object Array Iterator]"===r?"arrayiterator":"[object Int8Array]"===r?"int8array":"[object Uint8Array]"===r?"uint8array":"[object Uint8ClampedArray]"===r?"uint8clampedarray":"[object Int16Array]"===r?"int16array":"[object Uint16Array]"===r?"uint16array":"[object Int32Array]"===r?"int32array":"[object Uint32Array]"===r?"uint32array":"[object Float32Array]"===r?"float32array":"[object Float64Array]"===r?"float64array":"object"}},86859:function(e,t,r){"use strict";function i(e){return"string"!=typeof e&&(e=JSON.stringify(e)),function(e){if(function(){try{return"8J+mhA=="===btoa("\ud83e\udd84")}catch(e){return!1}}())return btoa(e);return btoa(function(e){if("function"==typeof TextEncoder){const t=(new TextEncoder).encode(e);return Array.from(t,(e=>String.fromCodePoint(e))).join("")}return e.replace(s,o)}(e))}(e).replace(/[+/]/g,(e=>n[e])).replace(/={1,3}$/,"")}r.d(t,{A:function(){return i}});const n={"+":"-","/":"_"};const s=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,a=e=>String.fromCharCode(e);function o(e){if(e.length<2){const t=e.charCodeAt(0);return t<128?e:t<2048?a(192|t>>>6)+a(128|63&t):a(224|t>>>12&15)+a(128|t>>>6&63)+a(128|63&t)}const t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return a(240|t>>>18&7)+a(128|t>>>12&63)+a(128|t>>>6&63)+a(128|63&t)}},59194:function(e,t,r){"use strict";r.d(t,{o:function(){return n}});var i=r(91139);function n(e){if(null==e||"object"!=typeof e)return e;let t=null;if((0,i.$P)(e))t=new Date(e.getTime());else{t=e.constructor();for(const r in e)t[r]=n(e[r])}return t}},91139:function(e,t,r){"use strict";r.d(t,{$P:function(){return o},Et:function(){return u},Gv:function(){return s},Kg:function(){return l},Lm:function(){return c},Tn:function(){return d},b0:function(){return m},cy:function(){return a},kK:function(){return h},kZ:function(){return p}});var i=r(51361),n=r.n(i);function s(e){return"object"===n()(e)}function a(e){return"array"===n()(e)}function o(e){return"date"===n()(e)}function u(e){return"number"===n()(e)}function c(e){return"boolean"===n()(e)}function l(e){return"string"===n()(e)}function d(e){return"function"===n()(e)}function h(e){return function(e){if(!l(e))return e;const t=e.slice(0,1).toUpperCase(),r=e.slice(1,e.length);return t+r}(n()(e))}function m(e){return"undefined"===n()(e)}function p(e){return"null"===n()(e)}},11691:function(e,t,r){"use strict";function i(e){return e.reduce(((e,t,r)=>{const[i,n]=Object.entries(t)[0];return"$match"===i&&0===r?{preFilteringStep:n}:"$match"===i?{...e,postFilteringStep:n}:"$group"===i?{...e,processingStep:n}:e}),{})}r.d(t,{A:function(){return i}})},48699:function(e,t,r){"use strict";r.r(t),r.d(t,{base64url:function(){return s.A},clone:function(){return i.o},extractForwardHeaders:function(){return d},getSchemaName:function(){return c},getSchemaNamespace:function(){return u},isArray:function(){return n.cy},isBoolean:function(){return n.Lm},isDate:function(){return n.$P},isFunction:function(){return n.Tn},isNull:function(){return n.kZ},isNumber:function(){return n.Et},isObject:function(){return n.Gv},isString:function(){return n.Kg},isUndefined:function(){return n.b0},parseDates:function(){return a.d},parseEntityJson:function(){return a.$h},parseSchemaId:function(){return l},serializeDates:function(){return a.oq},stringifyEntityJson:function(){return a.Dy},toPlatformizedAggregate:function(){return o.A},typeForDisplay:function(){return n.kK},validateHttpResponse:function(){return h}});var i=r(59194),n=r(91139),s=r(86859),a=r(7488),o=r(11691);function u(e){const t=e.lastIndexOf("/");return t>-1?e.substring(0,t):null}function c(e){const t=e.lastIndexOf("/");return t>-1?e.substring(t+1):e}function l(e){return{namespace:u(e),name:c(e)}}function d({headers:e={},query:t={}}){const r=["uuid","cid","authorization","wixsession2","cookie"],i={};for(const t in e){const s=t.toLowerCase();e.hasOwnProperty(t)&&(0===(n=s).indexOf("x-wix")||r.includes(n))&&(i[s]=e[t])}var n;const s="x-wix-request-id",a="request_id";return t&&t[a]&&(i[s]||(i[s]=t[a])),i}function h(e){if(e.status>=400){const t=JSON.stringify(e.data),r=new Error(`Request failed with status code ${e.status}. Data: '${t}'.`);throw r.response=e,r.config=e.config,r.request=e.request,r}return e}},7488:function(e,t,r){"use strict";function i(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}r.d(t,{$h:function(){return s},Dy:function(){return u},d:function(){return a},oq:function(){return o}});const n=e=>isNaN(e)&&!isNaN(new Date(e).getDate());function s(e){let t=null;return JSON.parse(e,(function(e,r){if("$date"===e&&n(r))t=new Date(r);else{if("$date"!==e){if(null!==t){const e=t;return t=null,e}return r}t={$date:r}}}))}function a(e){if("object"!=typeof e||i(e))return e;const t=l(e);for(const e in t)t[e]&&t[e].$date&&n(t[e].$date)?t[e]=new Date(t[e].$date):"object"==typeof t[e]&&null!==t[e]&&(t[e]=a(t[e]));return t}function o(e){if("object"!=typeof e||i(e))return e;const t=l(e);for(const e in t)t[e]&&i(t[e])?t[e]=c(t[e]):"object"==typeof t[e]&&null!==t[e]&&(t[e]=o(t[e]));return t}function u(e){return JSON.stringify(e,(function(e,t){return function(e,t,r){if(t&&i(e[t]))return c(e[t]);return r}(this,e,t)}))}function c(e){return{$date:e.toJSON()}}function l(e){return Array.isArray(e)?Object.assign([],e):{...e}}},51361:function(e){var t=Object.prototype.toString;function r(e){return"function"==typeof e.constructor?e.constructor.name:null}e.exports=function(e){if(void 0===e)return"undefined";if(null===e)return"null";var i=typeof e;if("boolean"===i)return"boolean";if("string"===i)return"string";if("number"===i)return"number";if("symbol"===i)return"symbol";if("function"===i)return"GeneratorFunction"===r(e)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(e))return"array";if(function(e){if(e.constructor&&"function"==typeof e.constructor.isBuffer)return e.constructor.isBuffer(e);return!1}(e))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(e))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(e))return"regexp";switch(r(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(e))return"generator";switch(i=t.call(e)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return i.slice(8,-1).toLowerCase().replace(/\s/g,"")}},37511:function(e){var t=Object.prototype.hasOwnProperty;function r(e){return"[Throws: "+(e?e.message:"?")+"]"}function i(e){var i=[];return function e(n){if(null===n||"object"!=typeof n)return n;if(-1!==i.indexOf(n))return"[Circular]";if(i.push(n),"function"==typeof n.toJSON)try{var s=e(n.toJSON());return i.pop(),s}catch(e){return r(e)}if(Array.isArray(n)){var a=n.map(e);return i.pop(),a}var o=Object.keys(n).reduce((function(i,s){return i[s]=e(function(e,i){if(t.call(e,i))try{return e[i]}catch(e){return r(e)}return e[i]}(n,s)),i}),{});return i.pop(),o}(e)}e.exports=function(e,t,r){return JSON.stringify(i(e),t,r)},e.exports.ensureProperties=i},36695:function(e,t,r){"use strict";r.d(t,{DataSdkFactory:function(){return yt}});var i=r(59194),n=r(91139),s=r(37511),a=r.n(s);const o=()=>"WDE0001: Collection name must be a string.",u=()=>"WDE0002: ItemId must be a string.",c=()=>"WDE0068: Item ids must be an array of strings",l=e=>`WDE0069: Failed to remove items from [${e}].\nCannot remove more than 1000 items in one request`,d=()=>"WDE0003: FieldName must be a string.",h=(e,t)=>`WDE0004: Failed to save [${e}] into [${t}].\nItems must be JavaScript objects.`,m=e=>`WDE0005: Failed to bulk save items into [${e}].\nItems must be an array of JavaScript objects and itemIds must be strings if present.`,p=e=>`WDE0006: Failed to bulk save items into [${e}].\nCannot insert more than 1000 items in one request`,g=()=>"WDE0007: Invalid update. Updated object must have a string _id property.",f=(e,t,r,i)=>`WDE0008: wixData.${e} expects between ${t} and ${r} arguments, but was called with ${i}.`,v={aggregateInvalid:(e,t)=>`Failed to perform aggregation on [${e}].\n${t.join("\n")}`,filterMustBeBuilder:e=>`WDE0011: Invalid ${e} usage. ${e} requires WixDataFilter.`,filterIsAlreadySet:e=>`WDE0012: Invalid ${e} usage. Filter is already set.`,groupIsAlreadySet:e=>`WDE0013: Invalid ${e} usage. Group is already set.`},y=e=>`Failed to build a filter.\n${e.join("\n")}.`,N=e=>`Failed to build group.\n${e.join("\n")}.`,_=e=>`Failed to build a sort.\n${e.join("\n")}.`,I=e=>`WDE0018: Options must be an object with one or all of the following boolean properties: ${e.join(", ")}.`,b=()=>"WDE0019: Reference operation takes a string ID or an object with an ID to be connected.",A=()=>"WDE0021: Invalid reference",$={queryInvalid:(e,t)=>`Failed to perform query on [${e}].\n${t.join("\n")}`,isNumber:(e,t,r)=>`WDE0032: Invalid ${e} parameter [${(0,n.kK)(r)}]. ${e} parameter must be a ${t} number.`,isPositiveNumber:(e,t)=>`WDE0033: Invalid ${e} parameter [${t}]. ${e} parameter must be a positive number.`,isNonNegativeNumber:(e,t)=>`WDE0034: Invalid ${e} parameter [${t}]. ${e} parameter must be a non-negative number.`,isInteger:(e,t)=>`WDE0035: Invalid ${e} parameter [${t}]. ${e} parameter must be an integer.`,isNonEmptyString:e=>`WDE0094: Invalid ${e} parameter. ${e} parameter must be non-empty string.`,notGreaterThan:(e,t,r)=>`WDE0036: Invalid ${e} parameter [${t}]. ${e} parameter cannot exceed ${r}.`,invalidSkipParameter:(e,t)=>`WDE0037: Invalid query on [${e}].\nInvalid prev positioned query skip on a negative number ${t}.`,noPrevPage:e=>`WDE0159: Invalid query on [${e}].\nThere is no prev page.`,noNextPage:e=>`WDE0165: Invalid query on [${e}].\nThere is no next page.`},E={arityIsZero:e=>`WDE0038: Invalid ${e} usage. ${e} does not take parameters.`,arityIsOne:e=>`WDE0039: Invalid ${e} usage. ${e} requires one parameter.`,arityIsTwo:e=>`WDE0040: Invalid ${e} usage. ${e} requires two parameters.`,arityIsThree:e=>`WDE0041: Invalid ${e} usage. ${e} requires three parameters.`,arityIsAtLeastTwo:e=>`WDE0042: Invalid ${e} usage. ${e} requires at least two parameters.`,arityIsAtLeastOne:e=>`WDE0043: Invalid ${e} usage. ${e} requires at least one parameter.`},S={typeIsString:(e,t)=>`WDE0044: Invalid ${e} parameter value [${(0,n.kK)(t)}]. ${e} parameter must be a String.`,typeIsStringNumberOrDate:(e,t)=>`WDE0045: Invalid ${e} parameter value [${(0,n.kK)(t)}]. Valid ${e} parameter types are String, Number or Date.`,sameType:(e,t,r)=>`WDE0046: Invalid ${e} parameter values [${(0,n.kK)(t)}] and [${(0,n.kK)(r)}]. Both parameters must be of the same type.`,typeIsStringNumberOrDateForAll:e=>`WDE0047: Invalid ${e} usage. ${e} supports only Number, String or Date items.`,validFieldName:(e,t)=>`WDE0048: Invalid ${e} field value [${(0,n.kK)(t)}]. ${e} field must be a String.`,isInstanceOfSameClass:(e,t,r)=>`WDE0049: Invalid ${e} parameter [${(0,n.kK)(r)}]. ${e} expects ${t} only.`,isForCollection:(e,t,r)=>`WDE0050: Invalid ${e} parameter query for [${r}]. ${e} accepts ${t} for the same collection only.`},D={objectType:(e,t)=>`WDE0056: ${e} should be an Object. Got ${k(t)} instead`,arrayType:(e,t)=>`WDE0057: ${e} should be an Array. Got ${k(t)} instead`,arrayLength:(e,t,r)=>`WDE0057: ${k(r)}.length is ${r.length}. ${e} Array should have length ${t}`,comparisonOperatorType:(e,t)=>`WDE0058: ${e} should be a Date, Number, or String. Got ${k(t)} instead`,stringOperatorType:(e,t)=>`WDE0059: ${e} should be a String. Got ${k(t)} instead`,setOperatorItems:(e,t)=>`WDE0060: ${e} Array should only contain values of types Date, Number, and String. Got ${k(t)} instead`,inOperatorItems:e=>`WDE0061: $in Array should have length 2, and match [String, Number]. Got ${k(e)} instead`,matchesOperatorRequiredProperty:(e,t)=>`WDE0062: $matches value ${k(t)} does not have property ${e}`,matchesOperatorIgnoreCase:e=>`WDE0063: $matches.ignoreCase should equal true. Got ${k(e)} instead`,matchesOperatorSpecItems:e=>`WDE0064: $matches.spec Array values should be either {"type":"anyOf","value":" -"} or {"type":"literal","value":String}. Got ${k(e)} instead`,regexNotAllowed:()=>"WDE0070: $regex keyword is not allowed."},O={typeIsStringOrArrayOfStrings:(e,t)=>`WDE0051: Invalid ${e} parameters [${t.map(n.kK)}]. Valid ${e} values are String, Array of String or varargs String.`},C={sortModelType:e=>`WDE0065: Sort Model should be an Array. Got ${k(e)} instead`,sortModelItemType:e=>`WDE0066: Sort Model Array should contain values of type Object only. Got ${k(e)} instead`,sortModelItem:e=>`WDE0067: Sort Model Array items should have a single property with value "asc" or "desc". Got ${k(e)} instead`},j=e=>"WDE0055: Failed to parse server response."+(e?` ${e}`:""),T=()=>"WDE0080: Skip is not supported in cursor paging.",w=()=>"WDE0109: Payload is too large.";function k(e){return a()(e)}const x={ItemDoesNotExist:"WD_ITEM_DOES_NOT_EXIST",ItemAlreadyExists:"WD_ITEM_ALREADY_EXISTS",SiteInTemplateMode:"WD_SITE_IN_TEMPLATE_MODE",UnknownError:"WD_UNKNOWN_ERROR",ValidationError:"WD_VALIDATION_ERROR",CollectionDeleted:"WD_COLLECTION_DELETED",SchemaDoesNotExist:"WD_SCHEMA_DOES_NOT_EXIST",PermissionDenied:"WD_PERMISSION_DENIED",BadRequest:"WD_BAD_REQUEST",Unauthorized:"WD_UNAUTHORIZED",TooManyRequests:"WD_TOO_MANY_REQUESTS",RequestTimedOut:"WD_REQUEST_TIMED_OUT",QuotaExceeded:"WD_DATABASE_QUOTA_EXCEEDED",QueryExecutionError:"WD_QUERY_EXECUTION_ERROR"};function P(e,t,r){return F(e,t,r)}function W(e){return F(e,x.ValidationError)}function F(e,t,r){const i=new(t&&t!==x.UnknownError?R:Error)(e);return i.code=t,r&&(i.details=r),i}class R extends Error{constructor(e){super(e),this.name="Error",this.errorGroup="User",Error.captureStackTrace&&Error.captureStackTrace(this,R)}}class V extends Error{constructor(e,t,r,i,n){super(e),this.message=e,this.code=t,this.item=r,this.name=i,this.originalIndex=n,Error.captureStackTrace&&Error.captureStackTrace(this,V)}}class B{constructor(){this._validations=[]}arityIsZero(e){return this.addValidation((()=>0===e.length),(()=>E.arityIsZero(this.operatorName??"")))}arityIsOne(e){return this.addValidation((()=>1===e.length),(()=>E.arityIsOne(this.operatorName??"")))}arityIsTwo(e){return this.addValidation((()=>2===e.length),(()=>E.arityIsTwo(this.operatorName??"")))}arityIsThree(e){return this.addValidation((()=>3===e.length),(()=>E.arityIsThree(this.operatorName??"")))}arityIsAtLeastTwo(e){return this.addValidation((()=>e.length>=2),(()=>E.arityIsAtLeastTwo(this.operatorName??"")))}arityIsAtLeastOne(e){return this.addValidation((()=>e.length>=1),(()=>E.arityIsAtLeastOne(this.operatorName??"")))}addValidation(e,t){return this._validations.push({predicateFn:e,messageFn:t}),this}}class q extends B{constructor(e){super(),this._invalidArguments=(0,i.o)(e)}validateAndAggregate(){const e=this._validations.every((({predicateFn:e,messageFn:t})=>this._appendIfInvalid(e(),t())));return[this._invalidArguments,e]}_appendIfInvalid(e,t){return!!e||(this._invalidArguments.push(t),!1)}}class M extends B{validateAndReject(){return Promise.resolve().then((()=>{this._validations.forEach((({predicateFn:e,messageFn:t})=>{if(!e())throw W(t())}))}))}validateAndReturn(){const e=[];return this._validations.forEach((({predicateFn:t,messageFn:r})=>{t()||e.push(r())})),e}}class z extends M{arity(e,t,r,i){return this.addValidation((()=>t.length<=i&&t.length>=r),(()=>f(e,r,i,t.length)))}_isObject(e,t){return this.addValidation((()=>(0,n.Gv)(e)),(()=>h(e,t)))}item(e,t,r){return this._isObject(e,t).addValidation((()=>void 0!==e._id?(0,n.Kg)(e._id):!r),(()=>g()))}items(e,t){return this.addValidation((()=>(0,n.cy)(e)&&e.every((e=>(0,n.Gv)(e)&&(void 0===e._id||null===e._id||(0,n.Kg)(e._id))))),(()=>m(t))).addValidation((()=>e.length<=1e3),(()=>p(t)))}fieldName(e){return this.addValidation((()=>(0,n.Kg)(e)),(()=>d()))}itemId(e){return this.addValidation((()=>(0,n.Kg)(e)),(()=>u()))}itemIds(e,t){return this.addValidation((()=>(0,n.cy)(e)&&e.every((e=>(0,n.Kg)(e)))),(()=>c())).addValidation((()=>e.length<=1e3),(()=>l(t)))}_options(e,t){return this.addValidation((()=>{const r=(0,n.Gv)(e)&&t.every((t=>{return"language"===t?null==(r=e[t])||(0,n.Kg)(r)&&r.length>0:function(e){return null==e||(0,n.Lm)(e)}(e[t]);var r}));return null==e||r}),(()=>I(t)))}referenceRemoveParameters(e){return this.addValidation((()=>(0,n.cy)(e)&&e.every(G)),b)}referenceParameters(e){return this.addValidation((()=>(0,n.cy)(e)&&e.every(L)),b)}referenceParameter(e){return this.addValidation((()=>L(e)),b)}isNonEmptyString(e,t){return this.addValidation((()=>"string"==typeof e&&e.length>0),(()=>$.isNonEmptyString(t)))}references(e){return this.addValidation((()=>(0,n.cy)(e)&&e.every((e=>(0,n.Kg)(e.relationshipName)&&L(e.left)&&L(e.right)))),A)}options(e){return this._options(e,["suppressAuth","suppressHooks","showDrafts","consistentRead","language"])}bulkInsertOptions(e){return this._options(e,["suppressAuth","suppressHooks","overrideExisting"])}bulkUpdateOptions(e){return this._options(e,["suppressAuth","suppressHooks","showDrafts"])}bulkRemoveOptions(e){return this._options(e,["suppressAuth","suppressHooks","showDrafts"])}truncateOptions(e){return this._options(e,["suppressAuth"])}collectionName(e){return this.addValidation((()=>(0,n.Kg)(e)),(()=>o()))}}function U(){return new z}function L(e){return(0,n.Kg)(e)&&""!==e||(0,n.Gv)(e)&&e.hasOwnProperty("_id")}function G(e){return(0,n.Kg)(e)||(0,n.Gv)(e)&&e.hasOwnProperty("_id")}var K=r(69012),H=r.n(K);function Q(e){return"array"===H()(e)}function J(e){return"date"===H()(e)}function X(e){return"string"===H()(e)}function Z(e){return function(e){if(!X(e))return e;const t=e.slice(0,1).toUpperCase(),r=e.slice(1,e.length);return t+r}(H()(e))}function Y(e){if(null==e||"object"!=typeof e)return e;let t=null;if(J(e))t=new Date(e.getTime());else{t=e.constructor();for(const r in e)t[r]=Y(e[r])}return t}class ee{constructor(e,t,r){this._validations=[],this.operatorName=e,this.ctor=r,this._invalidArguments=Y(t)}typeIsString(e){return this.addValidation((()=>X(e)),(()=>`Invalid ${this.operatorName} parameter value [${Z(e)}]. ${this.operatorName} parameter must be a String.`))}typeIsStringNumberOrDate(e){return this.addValidation((()=>te(e)),(()=>`Invalid ${this.operatorName} parameter value [${Z(e)}]. Valid ${this.operatorName} parameter types are String, Number or Date.`))}sameType(e,t){return this.addValidation((()=>Z(e)===Z(t)),(()=>`Invalid ${this.operatorName} parameter values [${Z(e)}] and [${Z(t)}]. Both parameters must be of the same type.`))}typeIsStringNumberOrDateForAll(e){return this.addValidation((()=>e.every(te)),(()=>`Invalid ${this.operatorName} usage. ${this.operatorName} supports only Number, String or Date items.`))}validFieldName(e){return this.addValidation((()=>X(e)),(()=>`Invalid ${this.operatorName} field value [${Z(e)}]. ${this.operatorName} field must be a String.`))}isInstanceOfSameClass(e){return this.addValidation((()=>e instanceof this.ctor),(()=>`Invalid ${this.operatorName} parameter [${Z(e)}]. ${this.operatorName} expects FilterBuilder only.`))}arityIsOne(e){return this.addValidation((()=>1===e.length),(()=>`Invalid ${this.operatorName} usage. ${this.operatorName} requires one parameter.`))}arityIsTwo(e){return this.addValidation((()=>2===e.length),(()=>`Invalid ${this.operatorName} usage. ${this.operatorName} requires two parameters.`))}arityIsThree(e){return this.addValidation((()=>3===e.length),(()=>`Invalid ${this.operatorName} usage. ${this.operatorName} requires three parameters.`))}arityIsAtLeastTwo(e){return this.addValidation((()=>e.length>=2),(()=>`Invalid ${this.operatorName} usage. ${this.operatorName} requires at least two parameters.`))}addValidation(e,t){return this._validations.push({predicateFn:e,messageFn:t}),this}validateAndAggregate(){const e=this._validations.every((({predicateFn:e,messageFn:t})=>this._appendIfInvalid(e(),t())));return[this._invalidArguments,e]}_appendIfInvalid(e,t){return!!e||(this._invalidArguments.push(t),!1)}}function te(e){return X(e)||(t=e,"number"===H()(t))||J(e);var t}const re=[function(e){const t=e.$and;if(Array.isArray(t)&&1===t.length)return t[0]},function(e){const t=e.$and;if(Array.isArray(t)&&0===t.length)return{};return null},function(e){const t=e.$and;if(!t)return;let r=[],i=[];if(t.forEach((e=>{!function(e){const t=Object.keys(e);return t.every((e=>e.startsWith("$")))&&t.length>0}(e)?r=[...r,e]:i=[...i,e]})),r.length<=1||function(e){const t=e.map((e=>Object.keys(e))).reduce(((e,t)=>[...e,...t]),[]);return function(e){const t={};return e.forEach((e=>t[e]=!0)),Object.keys(t)}(t).length!==t.length}(r))return;return{$and:[Object.assign({},...r),...i]}},function(e){const t=e.$and;if(!t)return;if(!t.find((e=>e.$and)))return;return{$and:t.reduce(((e,t)=>{const r=t.$and;return r?[...e,...r]:[...e,t]}),[])}},function(e){const t=e.$or;if(!t)return;if(!t.find((e=>e.$or)))return;return{$or:t.reduce(((e,t)=>{const r=t.$or;return r?[...e,...r]:[...e,t]}),[])}}];function ie(e){const[t]=ne(e);return t}function ne(e){return Array.isArray(e)?function(e){const t=e.map(ne),r=0<t.filter((([,e])=>e)).length;return[t.map((([e])=>e)),r]}(e):"object"!=typeof e||null===e||e instanceof Date?[e,!1]:function(e){const[t,r]=a(e),[i,n]=s(t);return[i,r||n];function s(e){const t=function(e){for(const t of re){const r=t(e);if(r)return r}}(e);if(!t)return[e,!1];const[r]=ne(t);return[r,!0]}function a(e){const t=Object.entries(e).map(o).filter((([,,e])=>e));return[{...e,...u(t)},!!t.length]}function o([e,t]){const[r,i]=ne(t);return[e,r,i]}function u(e){return e.reduce(((e,[t,r])=>({...e,[t]:r})),{})}}(e)}function se(...e){return{$and:e}}function ae(e){return e&&e.$and&&0===e.$and.length}var oe=(e=class{})=>class extends e{constructor(e={}){super(e),this.filterTree=e.filterTree||{$and:[]},this.invalidArguments=e.invalidArguments||[],this.encoder=e.encoder||{}}eq(...e){return this._binaryAnd("$eq",".eq",e)}ne(...e){return this._binaryAnd("$ne",".ne",e)}ge(...e){return this._AndLogicalEquivalence("$gte",".ge",e)}gt(...e){return this._AndLogicalEquivalence("$gt",".gt",e)}le(...e){return this._AndLogicalEquivalence("$lte",".le",e)}lt(...e){return this._AndLogicalEquivalence("$lt",".lt",e)}isNotEmpty(e){const[t,r]=this._filterValidator(".isNotEmpty").arityIsOne(arguments).validFieldName(e).validateAndAggregate();return r?this.ne(e,null):this._copy(this.filterTree,t)}isEmpty(e){const[t,r]=this._filterValidator(".isEmpty").arityIsOne(arguments).validFieldName(e).validateAndAggregate();return r?this.eq(e,null):this._copy(this.filterTree,t)}startsWith(...e){return this._AndStringOperand("$startsWith",".startsWith",e)}endsWith(...e){return this._AndStringOperand("$endsWith",".endsWith",e)}contains(...e){return this._AndStringOperand("$contains",".contains",e)}hasSome(...e){return this._AndSetOperand("$hasSome",".hasSome",e)}hasAll(...e){return this._AndSetOperand("$hasAll",".hasAll",e)}or(e){const[t,r]=this._filterValidator(".or").arityIsOne(arguments).isInstanceOfSameClass(e).validateAndAggregate();if(r){const r=ae(this.filterTree)?[]:[this.filterTree];return this._copy(se({$or:[...r,e.filterTree]}),t.concat(e.invalidArguments))}return this._copy(this.filterTree,t)}and(e){const[t,r]=this._filterValidator(".and").arityIsOne(arguments).isInstanceOfSameClass(e).validateAndAggregate();if(r){const r=ae(this.filterTree)?[]:[this.filterTree];return this._copy(se(...r,e.filterTree),t.concat(e.invalidArguments))}return this._copy(this.filterTree,t)}not(e){const[t,r]=this._filterValidator(".not").arityIsOne(arguments).isInstanceOfSameClass(e).validateAndAggregate();if(r){const r=function(...e){return{$and:e.reduce(((e,t)=>Q(t.$and)?e.concat(t.$and):e.concat([t])),[])}}(Y(this.filterTree),{$not:[e.filterTree]});return this._copy(r,t.concat(e.invalidArguments))}return this._copy(this.filterTree,t)}between(e,t,r){const[i,n]=this._filterValidator(".between").arityIsThree(arguments).sameType(t,r).typeIsStringNumberOrDate(t).typeIsStringNumberOrDate(r).validateAndAggregate();return n?this.ge(e,t).lt(e,r):this._copy(this.filterTree,i)}getFilterModel(){if(this.invalidArguments.length>0)throw new Error(this.invalidArguments.join(" "));return ie(this.filterTree)}setFilterModel(e){return this._copy(e,[])}_binaryAnd(e,t,r){const[i,n]=Array.prototype.slice.call(r),[s]=this._filterValidator(t).arityIsTwo(r).validFieldName(i).validateAndAggregate(),a=this._makeNewFilter(i,e,n);return this._copy(a,s)}_AndLogicalEquivalence(e,t,r){const[i,n]=Array.prototype.slice.call(r),[s]=this._filterValidator(t).arityIsTwo(r).validFieldName(i).typeIsStringNumberOrDate(n).validateAndAggregate(),a=this._makeNewFilter(i,e,n);return this._copy(a,s)}_AndStringOperand(e,t,r){const[i,n]=Array.prototype.slice.call(r),[s]=this._filterValidator(t).arityIsTwo(r).validFieldName(i).typeIsString(n).validateAndAggregate(),a=this._makeNewFilter(i,e,n);return this._copy(a,s)}_AndSetOperand(e,t,r){const[i,...n]=Array.prototype.slice.call(r),s=Q(n[0])?n[0]:n,[a]=this._filterValidator(t).arityIsAtLeastTwo(r).validFieldName(i).typeIsStringNumberOrDateForAll(s).validateAndAggregate(),o=this._makeNewFilter(i,e,s);return this._copy(o,a)}_makeNewFilter(e,t,r){const i=Y(this.filterTree),n=void 0===r?null:r,s=this._buildFilter(e,t,n);if(Q(i.$and))return i.$and.push(s),i;return a=i,0===Object.keys(a).length?se(s):se(i,s);var a}_buildFilter(e,t,r){if("$eq"!==t){const i={};return i[e]={},i[e][t]=this._encode(r),i}{const t={};return t[e]=this._encode(r),t}}_encode(e){return t=this.encoder,"function"===H()(t)?this.encoder(e):e;var t}_copy(e,t){return new this.constructor({...this,filterTree:e,invalidArguments:t})}_filterValidator(e){return new ee(e,this.invalidArguments,this.constructor)}};oe();function ue(e){const t=e.split("-"),r=[];for(let e=0;e<t.length-1;e++)i(r,t[e]),r.push({type:"anyOf",value:" \t\n-"});return i(r,t[t.length-1]),r;function i(e,t){0!==t.length&&e.push({type:"literal",value:t})}}class ce extends q{constructor(e,t,r,i){super(t),this.operatorName=e,this.ctor=r,this.constructorName=i}typeIsString(e){return this.addValidation((()=>(0,n.Kg)(e)),(()=>S.typeIsString(this.operatorName,e)))}typeIsStringNumberOrDate(e){return this.addValidation((()=>le(e)),(()=>S.typeIsStringNumberOrDate(this.operatorName,e)))}sameType(e,t){return this.addValidation((()=>(0,n.kK)(e)===(0,n.kK)(t)),(()=>S.sameType(this.operatorName,e,t)))}typeIsStringNumberOrDateForAll(e){return this.addValidation((()=>e.every(le)),(()=>S.typeIsStringNumberOrDateForAll(this.operatorName)))}validFieldName(e){return this.addValidation((()=>(0,n.Kg)(e)),(()=>S.validFieldName(this.operatorName,e)))}isInstanceOfSameClass(e){return this.addValidation((()=>e instanceof this.ctor),(()=>S.isInstanceOfSameClass(this.operatorName,this.constructorName,e)))}isForCollection(e,t){return this.addValidation((()=>e.collectionName===t),(()=>S.isForCollection(this.operatorName,this.constructorName,e.collectionName)))}}function le(e){return(0,n.Kg)(e)||(0,n.Et)(e)||(0,n.$P)(e)}var de=(e=class{})=>class extends(oe(e)){constructor(e){super(e),this.validateCollectionName=e?.validateCollectionName??!0}or(e){const t=super.or.apply(this,arguments);return this._validateCollectionName(t,e,".or")}and(e){const t=super.and.apply(this,arguments);return this._validateCollectionName(t,e,".and")}not(e){const t=super.not.apply(this,arguments);return this._validateCollectionName(t,e,".not")}_validateCollectionName(e,t,r){if(e.invalidArguments.length>0||!this.validateCollectionName)return e;const i=function(e,t){if(!e||!e.constructor)return e;const r=e.collectionName?e.collectionName:t;return new e.constructor({...e,collectionName:r})}(t,this.collectionName),[n,s]=new ce(r,e.invalidArguments,this.constructor,this.constructorName??this.constructor.name).isForCollection(i,this.collectionName).validateAndAggregate();return s?e:this._copy(this.filterTree,n)}_matchesUrlized(e,t){const[r,i]=this._filterValidator("._matchesUrlized").arityIsTwo(arguments).validFieldName(e).typeIsString(t).validateAndAggregate();if(i){const i=this._makeNewFilter(e,...function(e){return t(e)?["$in",[e,Number.parseInt(e)]]:["$matches",{ignoreCase:!0,spec:ue(e)}];function t(e){return/^-?[0-9]{1,16}$/.test(e)}}(t));return this._copy(i,r)}return this._copy(this.filterTree,r)}getFilterModel(){if(this.invalidArguments.length>0)throw W(y(this.invalidArguments));return super.getFilterModel()}_filterValidator(e){return new ce(e,this.invalidArguments,this.constructor,this.constructorName??this.constructor.name)}};const he=(e=class{})=>class extends e{constructor(e={}){super(e),this.orderBy=e.orderBy||[],this.invalidArguments=e.invalidArguments||[]}ascending(...e){return this._sortClause("asc",".ascending",e)}descending(...e){return this._sortClause("desc",".descending",e)}getSortModel(){if(this.invalidArguments.length>0)throw W(_(this.invalidArguments));return this.orderBy}setSortModel(e){return this._copySort(e,[])}_sortClause(e,t,r){let s=[];this.orderBy&&(s=(0,i.o)(this.orderBy));const a=(o=s,u=e,e=>{const t={[e]:u};o.push(t)});var o,u;const c=(0,n.cy)(r[0])&&1===r.length?r[0]:Array.prototype.slice.call(r,0),[l,d]=this._sortValidator(t).arityIsAtLeastOne(r).allStrings(c).validateAndAggregate();return d&&c.forEach(a),this._copySort(s,l)}_sortValidator(e){return new me(e,this.invalidArguments)}_copySort(e,t){return new this.constructor({...this,orderBy:e,invalidArguments:t})}};class me extends q{constructor(e,t){super(t),this.operatorName=e}allStrings(e){return this.addValidation((()=>e.every(n.Kg)),(()=>O.typeIsStringOrArrayOfStrings(this.operatorName,e)))}}he();var pe=he;const ge=9007199254740991;class fe extends q{constructor(e,t){super(t),this.operatorName=e}_isNumber(e,t){return this.addValidation((()=>(0,n.Et)(t)),(()=>$.isNumber(this.operatorName,e,t)))}isPositiveNumber(e){return this._isNumber("positive",e).addValidation((()=>!Number.isNaN(e)&&e>0),(()=>$.isPositiveNumber(this.operatorName,e)))}isNonNegativeNumber(e){return this._isNumber("non-negative",e).addValidation((()=>!Number.isNaN(e)&&e>=0),(()=>$.isNonNegativeNumber(this.operatorName,e)))}isInteger(e){return this.addValidation((()=>!Number.isNaN(e)&&Number.isFinite(e)&&Number.isInteger(e)&&e<ge&&e>-9007199254740991),(()=>$.isInteger(this.operatorName,e)))}notGreaterThan(e,t){return this.addValidation((()=>e<=t),(()=>$.notGreaterThan(this.operatorName,e,t)))}nonEmptyString(e){return this.addValidation((()=>"string"==typeof e&&e.length>0),(()=>$.isNonEmptyString(this.operatorName)))}}function ve(e){return"string"==typeof e&&e.length>0}class ye extends(de(pe())){constructor(e){super(e),this.provider=e.provider,this.collectionName=e.collectionName,this.limitNumber=e.limitNumber,this.invalidArguments=e.invalidArguments,this.orderBy=e.orderBy,this.skipNumber=e.skipNumber,this.included=e.included,this.projectedFields=e.projectedFields,this.cursor=e.cursor}get constructorName(){return"WixDataQuery"}count(e){return Ne(this.invalidArguments,this.collectionName).then((()=>U().options(e).validateAndReject())).then((()=>this.provider.count(this.collectionName,this.getOptimizedFilter(),e))).then((e=>e.totalCount))}distinct(e,t){const r=r=>{const i=r.cursor?void 0:r.skipNumber,n=r.cursor?"":e,s=!!r.cursor||(t||{}).omitTotalCount;return r.provider.distinct(r.collectionName,r.getOptimizedFilter(),r.orderBy,n,i,r.limitNumber,t,r.cursor,void 0,s)};return Ne(this.invalidArguments,this.collectionName).then((()=>U().options(t).validateAndReject())).then((()=>U().fieldName(e).validateAndReject())).then((()=>r(this))).then((e=>new Ie({result:e,query:this,pagingFunction:r})))}_transformOrderingForAggregates(e=[],t){return e.length>0?e.filter((e=>e.hasOwnProperty(t))).map((e=>({_id:e[t]}))):null}_distinctValuesPipeline(e){return[this.filterTree&&Object.keys(this.filterTree).length>0?{$match:this.filterTree}:null,{$distinct:`$${e}`}].filter(this._stageFilter)}_stageFilter(e){return null!==e}fields(...e){const t=(0,i.o)(this.projectedFields);for(let r=0;r<e.length;r++)t.push(e[r]);return new ye({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:this.skipNumber,limitNumber:this.limitNumber,invalidArguments:this.invalidArguments,included:this.included,cursor:this.cursor,projectedFields:t})}find(e){const t=t=>{const r=t.cursor?void 0:t.skipNumber,i=!!t.cursor||e?.omitTotalCount;return t.provider.find(t.collectionName,t.getOptimizedFilter(),t.orderBy,r,t.limitNumber,e,t.included,i,t.cursor,t.projectedFields)};return Ne(this.invalidArguments,this.collectionName).then((()=>U().options(e).validateAndReject())).then((()=>t(this))).then((e=>new Ie({result:e,query:this,pagingFunction:t})))}limit(e){const[t]=this._queryValidator(".limit").arityIsOne(arguments).isPositiveNumber(e).isInteger(e).validateAndAggregate();return new ye({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:this.skipNumber,limitNumber:e,included:this.included,cursor:this.cursor,invalidArguments:t,projectedFields:this.projectedFields})}skip(e){const[t]=this._queryValidator(".skip").arityIsOne(arguments).isNonNegativeNumber(e).isInteger(e).validateAndAggregate();return new ye({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:e,limitNumber:this.limitNumber,included:this.included,cursor:this.cursor,invalidArguments:t,projectedFields:this.projectedFields})}include(...e){const t=(0,i.o)(this.included);for(let r=0;r<e.length;r++)t.push(e[r]);return new ye({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:this.skipNumber,limitNumber:this.limitNumber,invalidArguments:this.invalidArguments,included:t,cursor:this.cursor,projectedFields:this.projectedFields})}setFilterModel(e){const t=super.setFilterModel(e);return this._setQuerySpecificInvalidArguments(t)}getOptimizedFilter(){try{return ie(this.filterTree)}catch(e){return this.filterTree}}setSortModel(e){const t=super.setSortModel(e);return this._setQuerySpecificInvalidArguments(t)}_setQuerySpecificInvalidArguments(e){const t=(e,t)=>void 0!==e?t.validateAndAggregate()[0]:[],r=this._queryValidator(".limit",[]).isPositiveNumber(this.limitNumber).isInteger(this.limitNumber),i=this._queryValidator(".skip",[]).isNonNegativeNumber(this.skipNumber).isInteger(this.skipNumber),n=[...t(this.limitNumber,r),...t(this.skipNumber,i)];return Object.assign(e,{invalidArguments:n})}_queryValidator(e,t=this.invalidArguments){return new fe(e,t)}copy(e={}){return new ye({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,orderBy:this.orderBy,skipNumber:this.skipNumber,limitNumber:this.limitNumber,invalidArguments:this.invalidArguments,included:this.included,cursor:this.cursor,projectedFields:this.projectedFields,...e})}}function Ne(e,t){const r=((0,n.Kg)(t)?[]:[o()]).concat(e);return r.length>0?Promise.reject(W($.queryInvalid(t,r))):Promise.resolve()}function _e(e,t){return new ye({provider:e,collectionName:t,filterTree:{},orderBy:void 0,skipNumber:0,invalidArguments:[],included:[],projectedFields:[]})}class Ie{constructor(e){if(this._isCreatedByCursor=!1,this._offset=0,this._executeQuery=(e,t)=>{const r=ve(e)?this._getNewCursorQuery(e,t):this._getNewQuery(t);return this._pagingFunction(r).then((e=>new Ie({result:e,lastResult:this,isNext:t,query:r,pagingFunction:this._pagingFunction})))},!e)return;const t=e.result,r=e.result.pagingMetadata??{},i=e.lastResult;this._items=t.items,this._cursors=r.cursors,this._isCreatedByCursor=ve(e.query.cursor),this._query=e.query,this._partialIncludes=t.partialIncludes,this._pagingFunction=e.pagingFunction,this._hasNext=t.pagingMetadata?.hasNext||!1,this._totalCount=this._isCreatedByCursor?i?.totalCount:t.totalCount,e.query.limitNumber?this._effectivePageSize=e.query.limitNumber:i?._effectivePageSize?this._effectivePageSize=i._effectivePageSize:!this._hasNext&&r.cursors||(this._effectivePageSize=t.items.length),void 0!==e.query.skipNumber?this._offset=e.query.skipNumber:this._isCreatedByCursor&&this._effectivePageSize>0&&i&&(this._offset=e.isNext?i._offset+this._effectivePageSize:Math.max(0,i._offset-this._effectivePageSize))}get items(){return this._items}get length(){return this.items.length}get totalCount(){return this._totalCount}get query(){return this._query}get pageSize(){return this._query.limitNumber}get totalPages(){return 0===this.totalCount?0:this._effectivePageSize>0&&this.totalCount>0?Math.ceil(this.totalCount/this._effectivePageSize):0===this._offset&&!this.hasNext()&&this.totalCount>0?1:void 0}get currentPage(){if(0!==this.length)return this._effectivePageSize>0&&void 0!==this._offset?Math.ceil(this._offset/this._effectivePageSize):0===this._offset&&!this.hasNext()&&this.totalCount>0?0:void 0}get partialIncludes(){return this._partialIncludes}next(){return this.hasNext()?this._executeQuery(this.nextCursor,!0):this._rejectNoNextPage()}prev(){return this.hasPrev()?this._executeQuery(this.prevCursor,!1):this._rejectNoPrevPage()}get nextCursor(){return this._cursors&&this._cursors.next}get prevCursor(){return this._cursors&&this._cursors.prev}hasNext(){return this._hasNext}hasPrev(){return this._isCreatedByCursor||this._cursors?ve(this.prevCursor):this.currentPage>0}toJSON(){return{currentPage:this.currentPage,items:this.items,length:this.length,pageSize:this.pageSize,partialIncludes:this.partialIncludes,query:this.query,totalCount:this.totalCount,totalPages:this.totalPages}}_getNewQuery(e){return this.query.copy({skipNumber:e?this._nextOffset():this._prevOffset(),limitNumber:this._effectivePageSize,invalidArguments:[]})}_getNewCursorQuery(e,t){return this.query.copy({skipNumber:t?this._nextOffset():this._prevOffset(),filterTree:{},orderBy:void 0,cursor:e,invalidArguments:[]})}_nextOffset(){if(this._effectivePageSize)return this._offset+this._effectivePageSize}_prevOffset(){if(this._effectivePageSize)return Math.max(this._offset-this._effectivePageSize,0)}_rejectNoPrevPage(){return Promise.reject(W($.noPrevPage(this.query.collectionName)))}_rejectNoNextPage(){return Promise.reject(W($.noNextPage(this.query.collectionName)))}get nextSkipNumber(){return this._nextOffset()}get prevSkipNumber(){return this._prevOffset()}}const be=(e=class{})=>class extends e{constructor(e={}){super(e),this.groupByTree=e.groupByTree,this.invalidArguments=e.invalidArguments||[]}sum(e,t){const[r]=this._groupValidator(".sum").arityIsAtLeastOne(arguments).typeIsString(e).validateAndAggregate();return this._addAccumulator("sum",e,t,r)}avg(e,t){const[r]=this._groupValidator(".avg").arityIsAtLeastOne(arguments).typeIsString(e).validateAndAggregate();return this._addAccumulator("avg",e,t,r)}min(e,t){const[r]=this._groupValidator(".min").arityIsAtLeastOne(arguments).typeIsString(e).validateAndAggregate();return this._addAccumulator("min",e,t,r)}max(e,t){const[r]=this._groupValidator(".max").arityIsAtLeastOne(arguments).typeIsString(e).validateAndAggregate();return this._addAccumulator("max",e,t,r)}count(){const[e]=this._groupValidator(".count").arityIsZero(arguments).validateAndAggregate(),t=(0,i.o)(this.groupByTree)||{_id:Se()};return t.count={$sum:1},this._copy(t,e)}_addAccumulator(e,t,r,n){const s=(0,i.o)(this.groupByTree)||{_id:Se()},a=r||t+((o=e).charAt(0).toUpperCase()+o.slice(1));var o;const u={};return u[`$${e}`]=`$${t}`,s[a]=u,this._copy(s,n)}_copy(e,t){return new this.constructor({...this,groupByTree:e,invalidArguments:t})}_groupValidator(e){return new $e(e,this.invalidArguments)}};class Ae extends(be()){_build(){return function(e){if(e.length>0)throw W(N(e))}(this.invalidArguments),this.groupByTree}}class $e extends q{constructor(e,t){super(t),this.operatorName=e}typeIsString(e){return this.addValidation((()=>(0,n.Kg)(e)),(()=>S.typeIsString(this.operatorName,e)))}}function Ee(...e){const t=Se(...e);return new Ae({groupByTree:{_id:t}})}function Se(...e){if(1===e.length)return`$${e}`;if(e.length>1){const t={};return e.forEach((e=>t[e]=`$${e}`)),t}return"0"}function De(e,t,r){const i=e.skipNumber||0;let n=void 0===e.limitNumber?t:e.limitNumber;return r&&(n=Math.min(n,t)),r?i+n:i-n}class Oe extends(pe(be())){constructor(e={}){super(e),this.provider=e.provider,this.collectionName=e.collectionName,this.filterTree=e.filterTree,this.havingTree=e.havingTree,this.skipNumber=e.skipNumber||0,this.limitNumber=e.limitNumber,this.cursor=e.cursor,this.invalidArguments=e.invalidArguments||[]}filter(e){const[t]=this._aggregateValidator(".filter").arityIsOne(arguments).filterIsNotSet(this).filterBuilder(e).validateAndAggregate();return new Oe({provider:this.provider,collectionName:this.collectionName,filterTree:e.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:t.concat(e.invalidArguments)})}group(...e){let t=(0,i.o)(this.groupByTree);const[r]=this._aggregateValidator(".group").arityIsAtLeastOne(arguments).groupIsNotSet(t).validateAndAggregate();return t?"0"===t._id&&(t={...t,_id:Se(...e)}):t={_id:Se(...e)},new Oe({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:t,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:r})}having(e){const[t]=this._aggregateValidator(".having").arityIsOne(arguments).havingIsNotSet(this).filterBuilder(e).validateAndAggregate();return new Oe({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:e.filterTree,skipNumber:this.skipNumber,limitNumber:this.limitNumber,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:t.concat(e.invalidArguments)})}skip(e){const[t]=this._aggregateValidator(".skip").arityIsOne(arguments).isNonNegativeNumber(e).isInteger(e).validateAndAggregate();return new Oe({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:e,limitNumber:this.limitNumber,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:t})}limit(e){const[t]=this._aggregateValidator(".limit").arityIsOne(arguments).isPositiveNumber(e).isInteger(e).validateAndAggregate();return new Oe({provider:this.provider,collectionName:this.collectionName,filterTree:this.filterTree,groupByTree:this.groupByTree,havingTree:this.havingTree,skipNumber:this.skipNumber,limitNumber:e,cursor:this.cursor,orderBy:this.orderBy,invalidArguments:t})}run(e){const t=this,r=this._buildPipeline();return(i=this.invalidArguments,n=this.collectionName,i.length>0?Promise.reject(W(v.aggregateInvalid(n,i))):Promise.resolve()).then((()=>U().options(e).validateAndReject())).then((()=>this.provider.runAggregate(this.collectionName,r,this.limitNumber,e,this.cursor))).then((({items:e,hasNext:r,cursors:i})=>new Te({items:e,hasNext:r,aggregate:t,pageSize:e.length,cursors:i,createdByCursor:this.cursor})));var i,n}_buildPipeline(){return[this.filterTree?{$match:this.filterTree}:null,this.groupByTree?{$group:this.groupByTree}:null,this.groupByTree?{$project:Ce(this.groupByTree)}:null,this.havingTree?{$match:this.havingTree}:null,this.orderBy.length>0?{$sort:this.orderBy}:null,{$skip:this.skipNumber}].filter((e=>null!==e))}_aggregateValidator(e){return new ke(e,this.invalidArguments)}}function Ce(e){const t=Object.keys(e).map((e=>({[e]:1})));return(0,n.Gv)(e._id)?t.push(function(e){const t=Object.keys(e),r=t.map((e=>({[e]:`$_id.${e}`})));return Object.assign({},...r)}(e._id)):(0,n.Kg)(e._id)&&"0"!==e._id&&t.push({[e._id.substr(1)]:"$_id"}),Object.assign({},...t)}function je(e,t,r,i){return new Oe({provider:e,collectionName:t,cursor:i,limitNumber:r})}class Te{constructor(e){e&&(this._items=e.items,this._hasNext=e.hasNext,this._aggregate=e.aggregate,this._pageSize=e.pageSize,this._cursors=e.cursors,this._createdByCursor=e.createdByCursor)}get items(){return this._items}hasNext(){return this._hasNext}hasPrev(){return ve(this._createdByCursor)||this._cursors?ve(this.prevCursor):this._aggregate.skipNumber>0}get length(){return this._items.length}next(){if(!this.hasNext())return this._rejectNoNextPage();let e;if(ve(this.nextCursor))e=this._getNewCursorAggregate(this.nextCursor);else{const t=De(this._aggregate,this.length,!0);e=this._aggregate.skip(t)}return e.run()}prev(){if(!this.hasPrev())return this._rejectNoPrevPage();let e;return e=ve(this.prevCursor)?this._getNewCursorAggregate(this.prevCursor):this._aggregate.skip(Math.max(0,this._aggregate.skipNumber-this._aggregate.limitNumber)),e.run()}get nextCursor(){return this._cursors&&this._cursors.next}get prevCursor(){return this._cursors&&this._cursors.prev}_getNewCursorAggregate(e){const t=this._aggregate;return je(t.provider,t.collectionName,t.limitNumber,e)}_rejectNoPrevPage(){return Promise.reject(W($.noPrevPage(this._aggregate.collectionName)))}_rejectNoNextPage(){return Promise.reject(W($.noNextPage(this._aggregate.collectionName)))}}const we=9007199254740991;class ke extends q{constructor(e,t){super(t),this.operatorName=e}filterBuilder(e){return this.addValidation((()=>"FilterBuilder"===e.constructorName),(()=>v.filterMustBeBuilder(this.operatorName)))}filterIsNotSet(e){return this.addValidation((()=>void 0===e.filterTree),(()=>v.filterIsAlreadySet(this.operatorName)))}havingIsNotSet(e){return this.addValidation((()=>void 0===e.havingTree),(()=>v.filterIsAlreadySet(this.operatorName)))}groupIsNotSet(e){return this.addValidation((()=>function(e){return!e||"0"===e._id}(e)),(()=>v.groupIsAlreadySet(this.operatorName)))}_isNumber(e,t){return this.addValidation((()=>(0,n.Et)(t)),(()=>$.isNumber(this.operatorName,e,t)))}isPositiveNumber(e){return this._isNumber("positive",e).addValidation((()=>!Number.isNaN(e)&&e>0),(()=>$.isPositiveNumber(this.operatorName,e)))}isNonNegativeNumber(e){return this._isNumber("non-negative",e).addValidation((()=>!Number.isNaN(e)&&e>=0),(()=>$.isNonNegativeNumber(this.operatorName,e)))}isInteger(e){return this.addValidation((()=>!Number.isNaN(e)&&Number.isFinite(e)&&Number.isInteger(e)&&e<we&&e>-9007199254740991),(()=>$.isInteger(this.operatorName,e)))}}class xe extends(de()){get constructorName(){return"FilterBuilder"}_build(){return this.getFilterModel()}}de();function Pe(){return new xe({})}class We extends(pe()){_build(){return this.getSortModel()}}class Fe{constructor(e){e&&(this.count=e.count,this.total=e.total,this.cursors=e.cursors,this.hasNext=e.hasNext,this.hasPrev=e.hasPrev)}}class Re{constructor(e){if(!e)return;this._provider=e.provider,this._collectionName=e.collectionName,this._referenceAttribute=e.referenceAttribute,this._holdingItemId=e.holdingItemId,this._items=e.items,this._totalCount=e.totalCount,this._options=e.options;const{skip:t=0,limit:r}=e.options||{};this._skip=t,this._limit=r,this._cursors=e.cursors,this._createdByCursor=e.createdByCursor,this._hasNext=e.hasNext}get items(){return this._items}get totalCount(){return this._totalCount}get nextCursor(){return this._cursors&&this._cursors.next}get prevCursor(){return this._cursors&&this._cursors.prev}hasNext(){return this._hasNext}hasPrev(){return ve(this._createdByCursor)||this._cursors?ve(this.prevCursor):this._skip>0}next(){return this.hasNext()?ve(this.nextCursor)?this._getNewCursorQuery(this.nextCursor)._fetch().then((e=>e._withTotalCount(this._totalCount))):this._withChangedSkip(!0)._fetch():this._rejectNoNextPage()}prev(){return this.hasPrev()?ve(this.prevCursor)?this._getNewCursorQuery(this.prevCursor)._fetch().then((e=>e._withTotalCount(this._totalCount))):this._withChangedSkip(!1)._fetch():this._rejectNoPrevPage()}_rejectNoPrevPage(){return Promise.reject(W($.noPrevPage(this._collectionName)))}_rejectNoNextPage(){return Promise.reject(W($.noNextPage(this._collectionName)))}_withChangedSkip(e){const t=De({skipNumber:this._skip,limitNumber:this._limit},this._items.length,e);return Ve({items:this._items,totalCount:this._totalCount,pagingMetadata:new Fe({total:this._totalCount})},this._provider,this._collectionName,this._holdingItemId,this._referenceAttribute,{...this._options,skip:t,limit:this._limit})}_getNewCursorQuery(e){return Ve({},this._provider,this._collectionName,"",this._referenceAttribute,{cursor:e,limit:this._limit,omitTotalCount:!0})}_fetch(){return this._provider.queryReferenced(this._collectionName,this._holdingItemId,this._referenceAttribute,this._options).then((e=>Ve(e,this._provider,this._collectionName,this._holdingItemId,this._referenceAttribute,this._options)))}_withTotalCount(e){return this._totalCount=e,this}}function Ve(e,t,r,i,n,s){const{items:a,totalCount:o,pagingMetadata:u}=e,{total:c,cursors:l,hasNext:d=!1}=u||new Fe;return new Re({provider:t,collectionName:r,referenceAttribute:n,holdingItemId:i,items:a,totalCount:c||o,options:s,cursors:l,createdByCursor:s?.cursor,hasNext:d})}function Be(e,t){if(!e)return!1;if(Array.isArray(e))return e.some((e=>Be(e,t)));if("object"==typeof e){return Object.keys(e).some((r=>t(r)||Be(e[r],t)))}return!1}class qe{constructor(e){this.get=Me(((e,t,r,i)=>U().arity("get",e,2,3).collectionName(t).itemId(r).options(i).validateAndReject().then((()=>this.provider.get(t,r,i))).then(Ue))),this.insert=Me(((e,t,r,i)=>U().arity("insert",e,2,3).validateAndReject().then((()=>ze(this.provider,"insert")(t,r,i))))),this.query=e=>_e(this.provider,e),this.filter=()=>Pe(),this.sort=()=>new We,this.find=(e,t,r,i,n,s,a,o)=>{const u=_e(this.provider,e);u.filterTree=t,u.orderBy=r,u.skipNumber=i,u.limitNumber=n,u.included=a;const c={...s,omitTotalCount:o};return u.find(c)},this.remove=Me(((e,t,r,i)=>U().arity("remove",e,2,3).collectionName(t).itemId(r).options(i).validateAndReject().then((()=>this.provider.remove(t,r,i))).then(Ue))),this.truncate=Me(((e,t,r)=>U().arity("truncate",e,1,2).collectionName(t).options(r).validateAndReject().then((()=>this.provider.truncate(t,r))).then(Ue))),this.bulkRemove=Me(((e,t,r,i)=>U().arity("bulkRemove",e,2,3).collectionName(t).itemIds(r,t).options(i).validateAndReject().then((()=>this.provider.bulkRemove(t,r,i))).then(Ue).then((e=>{const t=e.errors.map((e=>new V(e.message,e.code,e.item,e.name,e.originalIndex)));return{...e,errors:t}})))),this.save=Me(((e,t,r,i)=>U().arity("save",e,2,3).validateAndReject().then((()=>ze(this.provider,"save")(t,r,i))))),this.update=Me(((e,t,r,i)=>U().arity("update",e,2,3).validateAndReject().then((()=>ze(this.provider,"update")(t,r,i))))),this.fetch=Me(((e,t,r,i,n)=>U().arity("fetch",e,3,4).isNonEmptyString(r,"cursor").validateAndReject().then((()=>{const e=_e(this.provider,t).limit(i);return e.cursor=r,e.included=void 0,e.projectedFields=void 0,e.filterTree=void 0,e.skipNumber=void 0,e.find(n)})))),this.fetchReferenced=Me(((e,t,r,i,n)=>U().arity("fetchReferenced",e,3,4).isNonEmptyString(r,"cursor").validateAndReject().then((()=>{const e={...n};return e.limit=i,e.cursor=r,e.omitTotalCount=!0,this.provider.queryReferenced(t,void 0,void 0,e).then((r=>Ve(r,this.provider,t,void 0,void 0,e)))})))),this.fetchAggregate=Me(((e,t,r,i,n)=>U().arity("fetchAggregate",e,3,4).isNonEmptyString(r,"cursor").validateAndReject().then((()=>je(this.provider,t,i,r).run(n))))),this.queryReferenced=Me(((e,t,r,i,n)=>U().arity("queryReferenced",e,3,4).referenceParameter(r).validateAndReject().then((()=>{const e=Ge(r),s=n||{};return this.provider.queryReferenced(t,e,i,s).then((r=>Ve(r,this.provider,t,e,i,n)))})))),this.insertReference=Me(((e,t,r,i,s,a)=>{let o,u,c;return(0,n.cy)(r)?(u=r,o=i,c=()=>U().arity("insertReference",e,2,3).references(u).validateAndReject()):(u=Le(s).map((e=>({relationshipName:r,left:i,right:e}))),o=a,c=()=>U().arity("insertReference",e,4,5).references(u).validateAndReject()),c().then((()=>this.provider.insertReferences(t,(e=>e.map((e=>({relationshipName:e.relationshipName,left:Ge(e.left),right:Ge(e.right)}))))(u),o)))})),this.replaceReferences=Me(((e,t,r,i,n,s)=>(n=Le(n).map(Ge),i=Ge(i),U().arity("replaceReferences",e,4,5).referenceParameter(i).referenceParameters(n).validateAndReject().then((()=>this.provider.replaceReferences(t,{relationshipName:r,left:i},n.map((e=>({relationshipName:r,right:e,left:i}))),s)))))),this.removeReference=Me(((e,t,r,i,n,s)=>(n=Le(n).map(Ge),i=Ge(i),U().arity("removeReference",e,4,5).referenceParameter(i).referenceRemoveParameters(n).validateAndReject().then((()=>1===n.length?this.provider.removeReference(t,r,i,n[0],s):this.provider.removeReferences(t,n.map((e=>({relationshipName:r,right:e,left:i}))),s)))))),this.isReferenced=Me(((e,t,r,i,n,s)=>U().arity("isReferenced",e,4,5).referenceParameter(i).referenceParameter(n).validateAndReject().then((()=>this.provider.isReferenced(t,r,Ge(i),Ge(n),s))))),this.bulkInsert=Me(((e,t,r,i)=>U().arity("bulkInsert",e,2,3).validateAndReject().then((()=>this.provider.bulkInsert(t,r,i))).then((e=>{const t=e.errors.map((e=>new V(e.message,e.code,e.item,e.name,e.originalIndex)));return{...e,errors:t}})))),this.bulkSave=Me(((e,t,r,i)=>U().arity("bulkSave",e,2,3).validateAndReject().then((()=>this.provider.bulkSave(t,r,i))).then((e=>{const t=e.errors.map((e=>new V(e.message,e.code,e.item,e.name,e.originalIndex)));return{...e,errors:t}})))),this.bulkUpdate=Me(((e,t,r,i)=>U().arity("bulkUpdate",e,2,3).validateAndReject().then((()=>this.provider.bulkUpdate(t,r,i))).then((e=>{const t=e.errors.map((e=>new V(e.message,e.code,e.item,e.name,e.originalIndex)));return{...e,errors:t}})))),this.getSchema=()=>this.provider.getSchema(),this.group=(...e)=>Ee(...e),this.aggregate=e=>function(e,t){return new Oe({provider:e,collectionName:t})}(this.provider,e),this.provider=e}get wixData(){return this}}function Me(e){return function(...t){return e(arguments,...t)}}function ze(e,t,r=!1){return(i,n,s)=>{return U().collectionName(i).item(n,i,r).options(s).validateAndReject().then((()=>function(e){const t=Be(e,(e=>e.startsWith("$"))),r=Be(e,(e=>e.includes(".")));t&&console.error("Data inserted contains field name prefixed with symbol '$'. It is not recommended to use such field names as it will not work with some data operations.");r&&console.warn("Data inserted contains field name containing symbol '.'. It is not recommended to use such field names as it will not work with some data operations.")}(n))).then((()=>e[t](i,n,s))).then(Ue).then((a=n,function(e){if(e){for(const t in e)e.hasOwnProperty(t)&&(a.hasOwnProperty(t)&&!0!==Object.getOwnPropertyDescriptor(a,t)?.writable||(a[t]=e[t]));for(const t in a)e.hasOwnProperty(t)||delete a[t];return a}}));var a}}function Ue(e){return e&&e.hasOwnProperty("item")?e.item:e}function Le(e){return(0,n.cy)(e)?e:[e]}function Ge(e){return(0,n.Gv)(e)?e._id:e}const{getSchemaNamespace:Ke}=r(48699);var He=r(7488);function Qe(e){return"WDE0020"===e||"WDE0024"===e?x.ValidationError:"WDE0025"===e?x.SchemaDoesNotExist:"WDE0026"===e?x.CollectionDeleted:"WDE0027"===e?x.PermissionDenied:"WDE0052"===e?x.SiteInTemplateMode:"WDE0073"===e?x.ItemDoesNotExist:"WDE0074"===e?x.ItemAlreadyExists:"WDE0022"===e||"WDE0007"===e?x.ValidationError:e}const Je="WDE0078",Xe="WDE0109",Ze="WDE0080",Ye=e=>t=>e("wix-data-error-response",{responseData:t?.response?.data,status:t?.response?.status,requestId:t?.response?.headers?.["x-wix-request-id"],error:t?.response?t.response:t})((()=>Promise.resolve())).then((()=>{if(function(e){return 413===e?.response?.status}(t))return P(w(),Xe);const e=t?.response?.data;return et(e)?function(e){const t=e.details.applicationError.data;if(t?.jsErrorValue){const{name:r,message:i,code:n}=t.jsErrorValue,s=new Error(i);return s.name=r,s.code=n,s.details=e.details,s}return t?.value}(e):function(e){return e?.details?.applicationError}(e)?tt(e):function(e){return e?.details?.validationError}(e)?function(e){const t=(e.details.validationError.fieldViolations||[]).map((e=>`${e.field}: ${e.description}`)),r=[e.message,...t].join("\n");return P(r,Ze,e.details)}(e):function(e){return(e?.message||"").startsWith("WDE")}(t)?t:function(e){const t=e=>e instanceof Error?`${e}`:JSON.stringify(e),r=e?.response?.headers?.["x-wix-request-id"],i=e?.response?.status,n=e?.response?.statusText,s=e?.response?e.response:e;let a=i?`${i}`:"";return a+=n?`(${n})`:"",a+=r?` ${r}`:"",a=a||t(e),P(j(a),x.UnknownError,s)}(t)})).then((e=>Promise.reject(e)));function et(e){return e?.details?.applicationError?.code===Je}const tt=e=>{const t=Qe(e.details.applicationError.code);return P(e.details.applicationError.description,t,e.details)};const rt=e=>t=>it(e)({message:t.itemMetadata.error.description,details:{applicationError:{code:t.itemMetadata.error.code,description:t.itemMetadata.error.description}},originalIndex:t.itemMetadata.originalIndex}),it=e=>t=>{const{message:r,code:i,name:n}=function(e){const t=e.details?.applicationError;if(et(e)){const e=t.data?.jsErrorValue;if(e)return{message:e.message,code:e.code,name:e.name};const r=t.data?.value;return"string"==typeof r?{message:r}:{}}return{code:Qe(t?.code)||x.UnknownError,message:t?.description||e.message,name:"Error"}}(t);return{message:r,code:i,name:n,originalIndex:t.originalIndex,item:e[t.originalIndex]}};var nt=r(11691),st=r(86859);const at=()=>e=>e();function ot(e){const t="object"==typeof e?Object.keys(e).filter((t=>"object"==typeof e[t]&&"_id"!==t)).map((t=>{const r=e[t],i=(e=>{switch(Object.keys(e)[0]){case"$sum":return"sum";case"$min":return"min";case"$avg":return"average";case"$max":return"max";default:return""}})(r),n=(e=>{const t=Object.values(e)[0];return"string"==typeof t&&t.startsWith("$")?t.substring(1):t})(r),s={resultFieldName:t};return"sum"===i&&1===n?s.itemCount={}:s[i]={itemFieldName:n},s})):[],r={groupingFields:(e=>"object"==typeof e?"object"==typeof e._id?Object.keys(e._id):"0"===e._id?[]:[e._id.substring(1)]:[])(e),operations:t};return r}const ut=e=>"object"==typeof e&&null!==e&&"get"in e&&"function"==typeof e.get;var ct,lt,dt,ht;!function(e){e.LIVE="LIVE",e.SANDBOX_PREFERRED="SANDBOX_PREFERRED",e.SANDBOX="SANDBOX"}(ct||(ct={}));class mt{constructor({cloudDataUrl:e="/_api/cloud-data",gridAppId:t,environment:r,httpClient:i,authHeader:n,traceWith:s=at}){this.cloudDataUrl=e,this.gridAppId=t,this.environment=r,this.httpClientProvider="function"==typeof i?i:()=>i,this.traceWith=s,this.authHeader=n}_unwrapDataItems(e){return e.map((e=>e.data))}_unwrapDataItem(e){return e&&e.hasOwnProperty("dataItem")&&e.dataItem.hasOwnProperty("data")?{item:e.dataItem.data}:e}insert(e,t,r){return this._traceWith("platformized-provider-insert",{collectionName:e})((()=>U().collectionName(e).item(t,e,!1).options(r).validateAndReject().then((()=>this._post("/v2/items",{...pt(r),dataCollectionId:e,dataItem:{id:t._id,dataCollectionId:e,data:t}},r))).then(this._unwrapDataItem)))}update(e,t,r){return this._traceWith("platformized-provider-update",{collectionName:e})((()=>U().collectionName(e).item(t,e,!1).options(r).validateAndReject().then((()=>this._post("/v2/items/update",{...pt(r),dataCollectionId:e,dataItem:{id:t._id,dataCollectionId:e,data:t}},r))).then(this._unwrapDataItem)))}save(e,t,r){return this._traceWith("platformized-provider-save",{collectionName:e})((()=>U().collectionName(e).item(t,e,!1).options(r).validateAndReject().then((()=>this._post("/v2/items/save",{...pt(r),dataCollectionId:e,dataItem:{id:t._id,dataCollectionId:e,data:t}},r))).then(this._unwrapDataItem)))}truncate(e,t){return this._traceWith("platformized-provider-truncate",{collectionName:e})((()=>U().collectionName(e).validateAndReject().then((()=>this._post("/v2/items/truncate",{dataCollectionId:e},t))).then((()=>Promise.resolve(null)))))}remove(e,t,r){return this._traceWith("platformized-provider-remove",{collectionName:e})((()=>U().collectionName(e).itemId(t).options(r).validateAndReject().then((()=>this._post("/v2/items/remove",{...pt(r),dataCollectionId:e,dataItemId:t},r))).then(this._unwrapDataItem).catch((e=>e&&e.code===x.ItemDoesNotExist?Promise.resolve(null):Promise.reject(e)))))}bulkRemove(e,t,r){return this._traceWith("platformized-provider-bulk-remove",{collectionName:e})((()=>U().collectionName(e).itemIds(t,e).bulkRemoveOptions(r).validateAndReject().then((()=>0===t.length?{removedItemIds:[],removed:0,skipped:0,errors:[]}:this._post("/v2/bulk/items/remove",{...pt(r),dataCollectionId:e,dataItemIds:t},r).then((({results:e})=>{const r=e.filter((e=>e.itemMetadata.success)),i=e.filter((e=>!e.itemMetadata.success&&"WDE0073"!==e.itemMetadata.error.code)),n=r.map((e=>e.itemMetadata.id));return{removedItemIds:n,removed:n.length,skipped:t.length-n.length-i.length,errors:i.map(rt(t))}})).catch((e=>e&&e.code===x.ItemDoesNotExist?Promise.resolve(null):Promise.reject(e)))))))}get(e,t,r){return this._traceWith("platformized-provider-get",{collectionName:e,itemId:t})((()=>U().collectionName(e).itemId(t).options(r).validateAndReject().then((()=>encodeURIComponent(t)===t?this._get(`/v2/items/${t}`,{...pt(r),dataCollectionId:e,dataItemId:t},r):this._post("/v2/items/get",{...pt(r),dataCollectionId:e,dataItemId:t},r))).then(this._unwrapDataItem).catch((e=>e&&e.code===x.ItemDoesNotExist?Promise.resolve(null):Promise.reject(e)))))}find(e,t,r,i,s,a,o,u,c,l){return this._traceWith("platformized-provider-find",{collectionName:e})((()=>U().collectionName(e).options(a).validateAndReject().then((()=>this._validateOrderBy(e,r))).then((()=>this._validateFilter(e,t))).then((()=>{const d=this._getDataQuery(t,r,s,i,c,l),h=(0,n.cy)(o)?o.map((e=>({fieldName:e}))):void 0;return this._get("/v2/items/query",{...pt(a),dataCollectionId:e,query:d,referencedItemOptions:h,returnTotalCount:!u},a).then((e=>{const{dataItems:t,pagingMetadata:r}=e,i=this._unwrapDataItems(t),s=!!i.find((e=>!(!(0,n.cy)(o)||!o.find((t=>{const r=e[t];return(0,n.cy)(r)&&r.length>=50})))));return{items:i,partialIncludes:s,totalCount:r.total,pagingMetadata:r}}))}))))}runAggregate(e,t,r,i,n){return this._traceWith("platformized-provider-aggregate",{collectionName:e})((()=>U().collectionName(e).options(i).validateAndReject().then((()=>{const s=(0,nt.A)(t);return this._get("/v2/items/aggregate",{...pt(i),dataCollectionId:e,initialFilter:s.preFilteringStep,aggregation:ot(s.processingStep),finalFilter:s.postFilteringStep,sort:this._platformizedSort(t),...this._getAggregatePaging(t,r,n)},i).then((e=>{const{results:t,pagingMetadata:{cursors:r,hasNext:i}}=e;return{items:t.map((e=>{if("object"==typeof e._id&&1===Object.keys(e._id).length){const t=e._id[Object.keys(e._id)[0]];e._id=t}return e})),hasNext:i,cursors:r}}))}))))}_platformizedSort(e){const t=e.find((e=>e.hasOwnProperty("$sort")));if(!t)return;return t.$sort.map((e=>{const[t,r]=Object.entries(e)[0];return{fieldName:t,order:"asc"===r?0:1}}))}_getDataQuery(e,t,r,i,n,s){return{filter:e,sort:t?this._mapOrderToSort(t):void 0,...this._getPaging(r,i,n),fields:s}}_getAggregatePaging(e,t,r){const i=e.find((e=>e.hasOwnProperty("$skip"))),n=void 0!==i?i.$skip:void 0;return this._getPaging(t,n,r)}_getPaging(e,t,r){if(r&&t>0)throw P(T(),x.ValidationError);return r?{cursorPaging:{limit:e,cursor:r}}:{paging:{offset:t,limit:e}}}count(e,t,r){return this._traceWith("platformized-provider-count",{collectionName:e})((()=>U().collectionName(e).options(r).validateAndReject().then((()=>this._validateFilter(e,t))).then((()=>this._get("/v2/items/count",{...pt(r),dataCollectionId:e,filter:t},r)))))}_sortingFromOrder(e,t){const r=((0,n.cy)(e)?e:[]).find((e=>e.hasOwnProperty(t))),i=r&&r.hasOwnProperty(t)?r[t]:void 0;return i?i.toUpperCase():i}distinct(e,t,r,i,n,s,a,o,u,c){return this._traceWith("platformized-provider-distinct",{collectionName:e})((()=>U().collectionName(e).options(a).validateAndReject().then((()=>this._validateOrderBy(e,r))).then((()=>this._validateFilter(e,t))).then((()=>{const l=this._getDataQuery(t,r,s,n,o,u);return this._get("/v2/items/query-distinct-values",{...pt(a),dataCollectionId:e,fieldName:i,filter:l.filter,order:this._sortingFromOrder(r,i),paging:l.paging,cursorPaging:l.cursorPaging,...c?{}:{returnTotalCount:!0}},a).then((({distinctValues:e,pagingMetadata:t})=>({items:e,totalCount:t.total,pagingMetadata:t})))}))))}bulkInsert(e,t,r){return this._traceWith("platformized-provider-bulk-insert",{collectionName:e})((()=>{const i=(r||{}).overrideExisting;return U().collectionName(e).items(t,e).bulkInsertOptions(r).validateAndReject().then((()=>{if(0===t.length)return{insertedItemIds:[],inserted:0,errors:[],skipped:0,updated:0};const n=i?"/v2/bulk/items/save":"/v2/bulk/items/insert";return this._post(n,{...pt(r),dataCollectionId:e,dataItems:t.map((t=>({id:t._id,dataCollectionId:e,data:t})))},r).then((({results:e})=>{const r=e.filter((e=>e.itemMetadata.success)),n=r.map((e=>e.itemMetadata.id)),s=r.filter((e=>"INSERT"===e.action)).length,a=r.filter((e=>"UPDATE"===e.action)).length,o=e.filter((e=>!e.itemMetadata.success&&"WDE0074"!==e.itemMetadata.error.code));return{insertedItemIds:n,inserted:s,skipped:i?0:t.length-n.length-o.length,updated:a,errors:o.map(rt(t))}}))}))}))}bulkSave(e,t,r){return this._traceWith("platformized-provider-bulk-save",{collectionName:e})((()=>U().collectionName(e).items(t,e).bulkInsertOptions(r).validateAndReject().then((()=>0===t.length?{insertedItemIds:[],updatedItemIds:[],inserted:0,updated:0,skipped:0,errors:[]}:this._post("/v2/bulk/items/save",{...pt(r),dataCollectionId:e,dataItems:t.map((t=>({id:t._id,dataCollectionId:e,data:t})))},r).then((({results:e})=>{const r=e.filter((e=>e.itemMetadata.success)),i=r.filter((e=>"INSERT"===e.action)),n=r.filter((e=>"UPDATE"===e.action)),s=i.map((e=>e.itemMetadata.id)),a=n.map((e=>e.itemMetadata.id)),o=e.filter((e=>!e.itemMetadata.success));return{insertedItemIds:s,updatedItemIds:a,inserted:i.length,skipped:t.length-s.length-a.length-o.length,updated:n.length,errors:o.map(rt(t))}}))))))}bulkUpdate(e,t,r){return this._traceWith("platformized-provider-bulk-update",{collectionName:e})((()=>U().collectionName(e).items(t,e).bulkUpdateOptions(r).validateAndReject().then((()=>0===t.length?{updatedItemIds:[],inserted:0,skipped:0,updated:0,errors:[]}:this._post("/v2/bulk/items/update",{...pt(r),dataCollectionId:e,dataItems:t.map((t=>({id:t._id,dataCollectionId:e,data:t})))},r).then((({results:e})=>{const r=e.filter((e=>e.itemMetadata.success)).filter((e=>"UPDATE"===e.action)),i=r.map((e=>e.itemMetadata.id)),n=e.filter((e=>!e.itemMetadata.success&&"WDE0073"!==e.itemMetadata.error.code));return{updatedItemIds:i,inserted:0,skipped:t.length-i.length-n.length,updated:r.length,errors:n.map(rt(t))}}))))))}queryReferenced(e,t,r,i){return this._traceWith("platformized-provider-query-referenced",{collectionName:e,order:i.order,skip:i.skip,limit:i.limit,cursorExists:i.cursor?"true":"false"})((()=>{const n=((i=i||{}).order||"ASC").toUpperCase(),s=i.skip||0,a=i.limit||50,o=i.cursor;return U().collectionName(e).options(i).validateAndReject().then((()=>this._get("/v2/items/query-referenced",{...pt(i),dataCollectionId:e,referringItemId:t,referringItemFieldName:r,order:n,...i?.omitTotalCount?{}:{returnTotalCount:!0},...this._getPaging(a,s,o)},i))).then((({results:e,pagingMetadata:t})=>({items:e.filter((e=>!!e.dataItem)).map((e=>e.dataItem.data)),totalCount:t.total,pagingMetadata:t})))}))}insertReference(e,t,r,i,n){return this._traceWith("platformized-provider-insert-reference",{collectionName:e})((()=>this.insertReferences(e,[{relationshipName:t,left:r,right:i}],n)))}insertReferences(e,t,r){return this._traceWith("platformized-provider-insert-references",{collectionName:e})((()=>U().collectionName(e).options(r).validateAndReject().then((()=>{const i=t.map((({relationshipName:e,left:t,right:r})=>({referringItemFieldName:e,referringItemId:t,referencedItemId:r})));return this._post("/v2/bulk/items/insert-references",{...pt(r),dataCollectionId:e,dataItemReferences:i},r)}))))}replaceReferences(e,t,r,i){return this._traceWith("platformized-provider-replace-references",{collectionName:e})((()=>U().collectionName(e).options(i).validateAndReject().then((()=>this._post("/v2/items/replace-references",{...pt(i),dataCollectionId:e,referringItemFieldName:t.relationshipName,referringItemId:t.left,newReferencedItemIds:r.map((({right:e})=>e))},i)))))}removeReference(e,t,r,i,n){return this._traceWith("platformized-provider-remove-reference",{collectionName:e})((()=>this.removeReferences(e,[{relationshipName:t,left:r,right:i}],n)))}removeReferences(e,t,r){return this._traceWith("platformized-provider-remove-references",{collectionName:e})((()=>U().collectionName(e).options(r).validateAndReject().then((()=>this._post("/v2/bulk/items/remove-references",{...pt(r),dataCollectionId:e,dataItemReferences:t.map((({relationshipName:e,left:t,right:r})=>({referringItemFieldName:e,referringItemId:t,referencedItemId:r})))},r)))))}isReferenced(e,t,r,i,n){return this._traceWith("platformized-provider-is-referenced",{collectionName:e})((()=>U().collectionName(e).options(n).validateAndReject().then((()=>this._post("/v2/items/is-referenced",{...pt(n),dataCollectionId:e,referringItemFieldName:t,referringItemId:r,referencedItemId:i},n))).then((({isReferenced:e})=>e))))}_mapOrderToSort(e){return e.flatMap((e=>Object.entries(e).map((([e,t])=>({fieldName:e,order:t.toUpperCase()})))))}_validateOrderBy(e,t){const r=e=>C.sortModelType(e);if([null,void 0].includes(t))return Promise.resolve();if(i=t,!(0,n.cy)(i))return Promise.reject(this._validationError(e,[r(t)]));var i;const s=t.flatMap((e=>(e=>!(0,n.Gv)(e))(e)?(e=>C.sortModelItemType(e))(e):(e=>{const t=Object.values(e);return!(1===t.length&&("asc"===t[0]||"desc"===t[0]))})(e)?(e=>C.sortModelItem(e))(e):[]));return s.length?Promise.reject(this._validationError(e,s)):Promise.resolve()}_validateFilter(e,t){const r=D.objectType,i=D.arrayType,s=D.arrayLength,a=D.comparisonOperatorType,o=D.stringOperatorType,u=D.setOperatorItems,c=D.inOperatorItems,l=D.matchesOperatorRequiredProperty,d=D.matchesOperatorIgnoreCase,h=D.matchesOperatorSpecItems,m=D.regexNotAllowed,p=(e,t)=>void 0===t||(0,n.Gv)(t)?[]:[r(e,t)],g=(e,t)=>(0,n.cy)(t)?t.flatMap((t=>p(e,t))):[],f=(e,t)=>void 0===t||(0,n.cy)(t)?[]:[i(e,t)],v=(e,t)=>void 0===t||(0,n.Kg)(t)||(0,n.Et)(t)||(0,n.$P)(t)?[]:[a(e,t)],y=(e,t)=>void 0===t||(0,n.Kg)(t)?[]:[o(e,t)],N=(e,t)=>(0,n.cy)(t)?t.every((e=>(0,n.$P)(e)||(0,n.Kg)(e)||(0,n.Et)(e)))?[]:[u(e,t)]:[],_=(e,t,r)=>(0,n.cy)(t)?t.length===r?[]:[s(e,r,t)]:[],I=e=>{if(!(0,n.Gv)(e))return[];if(void 0===e.ignoreCase)return[l("ignoreCase",e)];if(!0!==e.ignoreCase)return[d(e.ignoreCase)];if(void 0===e.spec)return[l("spec",e)];if(!(0,n.cy)(e.spec))return[i("$matches.spec",e.spec)];const t=e.spec.find((e=>!(e=>!!(0,n.Gv)(e)&&("anyOf"===e.type&&" \t\n-"===e.value||!("literal"!==e.type||!(0,n.Kg)(e.value))))(e)));return void 0!==t?[h(t)]:[]},b=e=>{if(!(0,n.Gv)(e))return[];const{$and:t,$or:r,$not:i,$gt:s,$gte:a,$lt:o,$lte:u,$startsWith:l,$endsWith:d,$contains:h,$hasSome:A,$hasAll:$,$in:E,$matches:S,$regex:D,...O}=e;let C=[].concat(f("$and",t)).concat(g("Filter Model",t)).concat(f("$or",r)).concat(g("Filter Model",r)).concat(f("$not",i)).concat(g("Filter Model",i)).concat(f("$hasSome",A)).concat(f("$hasAll",$)).concat(f("$in",E)).concat(N("$hasSome",A)).concat(N("$hasAll",$)).concat(v("$gt",s)).concat(v("$gte",a)).concat(v("$lt",o)).concat(v("$lte",u)).concat(y("$startsWith",l)).concat(y("$endsWith",d)).concat(y("$contains",h)).concat(_("$not",i,1)).concat(_("$in",E,2)).concat((j=E,(0,n.cy)(j)?2!==j.length||(0,n.Kg)(j[0])&&(0,n.Et)(j[1])?[]:[c(j)]:[])).concat(p("$matches",S)).concat(I(S)).concat((e=>void 0===e?[]:[m()])(D));var j;return C.length?C:(C=[].concat(t?t.flatMap(b):[]).concat(r?r.flatMap(b):[]).concat(i?i.flatMap(b):[]),C.length?C:Object.values(O).flatMap(b))};if([null,void 0].includes(t))return Promise.resolve();if(!(0,n.Gv)(t))return Promise.reject(this._validationError(e,[r("Filter Model",t)]));const A=b(t);return A.length?Promise.reject(this._validationError(e,A)):Promise.resolve()}_validationError(e,t){return W($.queryInvalid(e,t))}_getAuthHeader(){return Promise.resolve(ut(this.authHeader)?this.authHeader.get():this.authHeader)}_get(e,t,r){return this._call(e,t,!0,r)}_post(e,t,r){return this._call(e,t,!1,r)}_call(e,t,r,i){return Promise.all([this._getGridAppId(),this._getAuthHeader()]).then((([n,s])=>{const a=`${this.cloudDataUrl}${e}`,o=e=>this.traceWith("wix-data-api-call",{url:a})((()=>{const e={...(0,He.oq)(t),environment:this.environment,appId:n},o=s?{authorization:s}:{};if(r){const t=`${a}?.r=${(0,st.A)(e)}`;if(t.length<=2048)return this.httpClientProvider(i).get(t,{headers:o,includeWixHeaders:!0})}return this.httpClientProvider(i).post(a,e,{headers:o,includeWixHeaders:!0})})).catch((t=>this.traceWith("wix-data retry handler",{retriesLeft:e,httpStatus:t?.response?.status,error:t,isGetRequest:r})((()=>r&&e>0&&503===t?.response?.status?o(e-1):Promise.reject(t)))));return o(2).catch(Ye(this.traceWith)).then((u=this.traceWith,e=>u("platformized-data-response",{requestId:e.headers?.["x-wix-request-id"]})((()=>(0,He.d)(e.data)))));var u}))}_getGridAppId(){return Promise.resolve(ut(this.gridAppId)?this.gridAppId.get():this.gridAppId)}_traceWith(e,t){return r=>this._getGridAppId().then((i=>this.traceWith(e,{gridAppId:i,environment:this.environment,...t})(r)))}}function pt(e){return{appOptions:e?.appOptions,suppressHooks:e?.suppressHooks,fields:e?.fields,consistentRead:e?.consistentRead,language:e?.language,includeReferencedItems:e?.includeReferences,...e?.showDrafts?{publishPluginOptions:{includeDraftItems:!0}}:{}}}!function(e){e.LIVE="LIVE",e.SANDBOX="SANDBOX",e.TRASH_LIVE="TRASH_LIVE"}(lt||(lt={})),function(e){e.ASC="ASC",e.DESC="DESC"}(dt||(dt={})),function(e){e.ASC="ASC",e.DESC="DESC"}(ht||(ht={}));const gt=()=>e=>e();function ft({cloudDataUrl:e="/_api/cloud-data",gridAppId:t,segment:r,environment:i,httpClient:n,authHeader:s,traceWith:a=gt}){const o=i||(r===lt.LIVE?ct.LIVE:ct.SANDBOX);return new qe(new mt({cloudDataUrl:e,gridAppId:t,environment:o,httpClient:n,authHeader:s,traceWith:a}))}const vt="data";function yt({featureConfig:e,platformUtils:{sessionService:t},appEssentials:r,platformEnvData:{site:i},appDefinitionId:n,blocksAppsUtils:s}){const a={get(){const e=t.getInstance(n);return s.isBlocksApp(n)&&s.canAppInstanceBeUsedForAuthorization(e)?e:t.getWixCodeInstance()}},o=Boolean(i.experiments["specs.thunderbolt.UseCloudDataUrlWithBaseExternalUrl"]),{gridAppId:u,environment:c,cloudDataUrl:l,cloudDataUrlWithExternalBase:d}=e,{httpClient:h}=r;return{[vt]:ft({cloudDataUrl:o?d:l,httpClient:h,gridAppId:u,environment:c,authHeader:a})}}}}]);
//# sourceMappingURL=feature-data-wix-code-sdk.afef2040.chunk.min.js.map